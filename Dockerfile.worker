# Dockerfile.worker
FROM node:18-alpine

WORKDIR /app

# Copy package files and PM2 ecosystem file
COPY package*.json ./
COPY ecosystem.config.js ./

# Install only production deps (worker deps must be in root dependencies)
RUN npm ci --only=production

# Copy scripts used by the worker
COPY scripts/ ./scripts/

# Install PM2 globally
RUN npm install -g pm2

# Use PM2 as entrypoint
CMD ["pm2-runtime", "start", "ecosystem.config.js"]
